# 项目需求及架构设计

<nav>
<a href="#一、项目需求分析">一、项目需求分析</a><br/>
<a href="#二、技术选型">二、技术选型</a><br/>
<a href="#三、系统数据流程设计">三、系统数据流程设计</a><br/>
    <a href="#四、框架版本选型">四、框架版本选型</a><br/>
    <a href="#五、服务器选型">五、服务器选型</a><br/>
    <a href="#六、集群资源规划设计">六、集群资源规划设计</a><br/>
</nav>

### 一、项目需求分析

**1.项目需求**

（1）用户行为数据采集平台搭建

（2）业务数据采集平台搭建

（3）数据仓库维度建模

（4）分析，设备、会员、商品、地区、活动等电商核心主题，统计的报表指标，可匹配中型企业

（5）采用即席查询工具，随时进行指标分析

（6）对集群性能进行监控，发生异常需要报警

（7）元数据管理

（8）质量监控



### 二、技术选型

技术选型主要考虑因素：数据量大小、业务需求、行内经验、技术成熟度、开发维护成本、总成本预算

数据采集传输：**Flume,Kafka,Sqoop,**Logstash,DataX

数据存储：**MySql，HDFS，**HBase,Redis,MongoDB

数据计算：**Hive,Tez,Spark**,Flink.Storm

数据查询：**Presto,Kylin,**Impala,Druid

数据可视化：**Echarts,Superset**,QuickBI,DataV

任务高度:**Azkaban**,Oozie

集群监控：**Zabbix**

元数据管理：**Atlas**



### 三、系统数据流程设计

![数据-02](E:\BigData-数据仓库\picture\数据-02.png)



### 四、框架版本选型

**1.如何选择Apache/CDH/HDP版本？**

（1）Apache：运维麻烦，组件间兼容性需要自己调研。（一般大厂使用，技术实力雄厚，有专业的运维人员）（建议使用）

（2）CDH：国内使用最多的版本，但CM不开源，2020年开始收费，一个节点1万美金。

（3）HDP：开源，可以进行二次开发，但是没有CDH稳定，国内使用较少

**2.Apache框架版本**

```
产品 Hadoop    版本 3.1.3
产品 Flume     版本 1.9.0
产品 Kafka     版本 2.4.1
产品 Hive   	 版本 3.1.2
产品 Sqoop     版本 1.4.6
产品 Zookeeper 版本 1.8
产品 Presto    版本 0.189
产品 Java      版本 1.8
```

建议：框架选型尽量不要选最新的构架，选择最新框架半年前左右稳定版的。



### 五、服务器选型

服务器选择物理机还是云主机？

**1.物理机**

以128G内存，20核物理CPU，40线程，8THDD和2TSSD硬盘，戴尔品牌，单台报价4W出头。一般物理机寿命5年左右。

需要有专业的运维人员，平均一个月1W。电费、网络、机房条件等开销

**2.云主机**

以阿里云为例，差不多相同配置，每年5W

很多运维工作都由阿里云完成，运维相对较轻松

**3.企业选择**

金融有钱公司和阿里没有直接冲突的公司选阿里云

中小公司、为了融资上市，选择阿里云，拉到融资后买物理机

有长期打算，资金比较足，选择物理机。



### 六、集群资源规划设计

**1.如何 确认集群规模？（假设：每台服务器8T，128G内存）**

（1）每天日活用户100万，每人一天平均100条：100万*100条=1亿条

（2）每条日志1k左右，每天1亿条：100000000/1024/1024=约100G

（3）半年内不扩容服务器来算：100G*180天=约18T

（4）保存3份副本：18T*3=54T

（5）预留20%~30%Buf=54T/0.7=77T

（6）到此：约8T*10台服务器

**2.如果考虑数仓分层？数据采用压缩？需要重新再计算（Hadoop3 纠删码等因素）**

**3.测试集群服务器规划**

| 服务名称           | 子服务                | 服务器  hadoop102 | 服务器  hadoop103 | 服务器  hadoop104 |
| ------------------ | --------------------- | ----------------- | ----------------- | ----------------- |
| HDFS               | NameNode              | √                 |                   |                   |
|                    | DataNode              | √                 | √                 | √                 |
|                    | SecondaryNameNode     |                   |                   | √                 |
| Yarn               | NodeManager           | √                 | √                 | √                 |
|                    | Resourcemanager       |                   | √                 |                   |
| Zookeeper          | Zookeeper Server      | √                 | √                 | √                 |
| Flume(采集日志)    | Flume                 | √                 | √                 |                   |
| Kafka              | Kafka                 | √                 | √                 | √                 |
| Flume（消费Kafka） | Flume                 |                   |                   | √                 |
| Hive               | Hive                  | √                 |                   |                   |
| MySQL              | MySQL                 | √                 |                   |                   |
| Sqoop              | Sqoop                 | √                 |                   |                   |
| Presto             | Coordinator           | √                 |                   |                   |
|                    | Worker                |                   | √                 | √                 |
| Azkaban            | AzkabanWebServer      | √                 |                   |                   |
|                    | AzkabanExecutorServer | √                 |                   |                   |
| Druid              | Druid                 | √                 | √                 | √                 |
| Kylin              |                       | √                 |                   |                   |
| Hbase              | HMaster               | √                 |                   |                   |
|                    | HRegionServer         | √                 | √                 | √                 |
| Superset           |                       | √                 |                   |                   |
| Atlas              |                       | √                 |                   |                   |
| Solr               | Jar                   | √                 |                   |                   |
| 服务数总计         |                       | 18                | 9                 | 9                 |



